{"version":3,"file":"soImgPreload.js","sources":["../src/imgPreload.js"],"sourcesContent":["/**\r\n * 图片预加载\r\n * @param {Array} list - 图片url 集合\r\n * @param {Object} opt - 配置项\r\n * @param {Function} opt.each - 每加载完成一张图片回调函数\r\n * @param {Function} opt.all - 所有图片加载完成回调函数\r\n */\r\nexport default function lcImgPreload(list = [], opt = {}) {\r\n  const totalLen = list.length\r\n  let allData = []\r\n  let loadedLength = 0\r\n  let successNum = 0\r\n  let failNum = 0\r\n  let now = Date.now()\r\n\r\n  /**\r\n   * 加载完成回调\r\n   * @param {String} status [success|fail] - 加载状态\r\n   * @param {String} url - 当前图片的url\r\n   * @param {Number} index - 当前图片下标\r\n   * @param {Number} time - 当前图片的加载占时，单位ms\r\n   */\r\n  function imgLoad(status, url, index, time) {\r\n    loadedLength++\r\n    status === 'success' ? successNum++ : failNum++\r\n    let totalTime = Date.now() - now\r\n    let obj = {\r\n      status: status,\r\n      index: index,\r\n      url: url,\r\n      time: time,\r\n    }\r\n    let speed = {\r\n      success: successNum,\r\n      fail: failNum,\r\n      total: totalLen,\r\n      totalTime: totalTime\r\n    }\r\n    opt.each && opt.each(obj, speed)\r\n    allData[index] = obj\r\n    if (opt.all && loadedLength === totalLen) {\r\n      opt.all(allData, speed)\r\n    }\r\n  }\r\n  list.forEach((p1, p2) => {\r\n    let img = new Image()\r\n    img.src = p1\r\n    img.onload = function () {\r\n      imgLoad('success', p1, p2, Date.now() - now)\r\n    }\r\n    img.onerror = function () {\r\n      imgLoad('fail', p1, p2, Date.now() - now)\r\n    }\r\n  })\r\n}\r\n"],"names":["list","opt","totalLen","length","allData","loadedLength","successNum","failNum","now","Date","imgLoad","status","url","index","time","totalTime","obj","speed","success","fail","total","each","all","forEach","p1","p2","img","Image","src","onload","onerror"],"mappings":"mPAOe,eAAsBA,yDAAO,GAAIC,yDAAM,GAC9CC,EAAWF,EAAKG,OAClBC,EAAU,GACVC,EAAe,EACfC,EAAa,EACbC,EAAU,EACVC,EAAMC,KAAKD,eASNE,EAAQC,EAAQC,EAAKC,EAAOC,GACnCT,IACW,YAAXM,EAAuBL,IAAeC,QAClCQ,EAAYN,KAAKD,MAAQA,EACzBQ,EAAM,CACRL,OAAQA,EACRE,MAAOA,EACPD,IAAKA,EACLE,KAAMA,GAEJG,EAAQ,CACVC,QAASZ,EACTa,KAAMZ,EACNa,MAAOlB,EACPa,UAAWA,GAEbd,EAAIoB,MAAQpB,EAAIoB,KAAKL,EAAKC,GAC1Bb,EAAQS,GAASG,EACbf,EAAIqB,KAAOjB,IAAiBH,GAC9BD,EAAIqB,IAAIlB,EAASa,GAGrBjB,EAAKuB,QAAQ,SAACC,EAAIC,OACZC,EAAM,IAAIC,MACdD,EAAIE,IAAMJ,EACVE,EAAIG,OAAS,WACXnB,EAAQ,UAAWc,EAAIC,EAAIhB,KAAKD,MAAQA,IAE1CkB,EAAII,QAAU,WACZpB,EAAQ,OAAQc,EAAIC,EAAIhB,KAAKD,MAAQA"}